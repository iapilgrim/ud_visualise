box: wercker-labs/docker

build:
    steps:
      - script:
         name: build pythonjs image
         code: |-
           cat /etc/hosts
           cd visualise
           sudo docker build -rm -t mrmrcoleman/visualise .
           WEB_WORKER=$(sudo docker run -p 5000:5000 -d mrmrcoleman/visualise /bin/bash -c "cd /opt/visualise/ && python run.py")
           telnet 127.0.0.1 5000
           cd visualise
           python ./test.py
           sudo docker stop $WEB_WORKER
deploy:
    steps:
      - wercker/add-ssh-key:
         keyname: EC2SSHKEY
      - script:
         name: deploy to EC2
         code: |-
           ssh -o StrictHostKeyChecking=no ubuntu@54.213.8.33 ls -ahl
